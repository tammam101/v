<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <title>WebAR — ArUco 5 (Scaled & Right)</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.4/aframe/build/aframe-ar.min.js"></script>
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#000}
    .a-loader,.a-loader-title{display:none!important} /* لا خلفية زرقاء ولا نقاط */
  </style>
</head>
<body>
  <a-scene
    embedded
    loading-screen="enabled:false"
    vr-mode-ui="enabled:false"
    renderer="alpha:true; antialias:true; logarithmicDepthBuffer:true"
    arjs="sourceType:webcam; facingMode:environment;
          sourceWidth:1280; sourceHeight:720;
          displayWidth:1280; displayHeight:720;
          trackingMethod:best; detectionMode:mono; debugUIEnabled:false;">

    <!-- أصول -->
    <a-assets timeout="60000">
      <!-- بدّل اسم الملف إذا عندك غيره -->
      <a-asset-item id="glb" src="free_droide_de_seguridad_k-2so_by_oscar_creativo.glb"></a-asset-item>
    </a-assets>

    <!-- ماركر ArUco (barcode) رقم 5 — size = قياس الطباعة بالمتر (هنا 16 سم) -->
    <a-marker id="marker" type="barcode" value="5" size="0.16"
              emitevents="true" hide-on-lost="false"
              smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">

      <!-- الموديل: يتم تحجيمه وإزاحته نسبياً لحجم الماركر -->
      <a-entity id="model"
                gltf-model="#glb"
                rotation="0 0 0"
                relative-to-marker="marker: #marker; offset: 0.65 0 0; scale-multiplier: 1.35"
                animation-mixer>
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // يحجّم ويزيح الموديل حسب مقياس الماركر (علاقة طردية + إلى اليمين)
    AFRAME.registerComponent('relative-to-marker', {
      schema: {
        marker: { type: 'selector' },
        offset: { type: 'vec3', default: { x: 0.65, y: 0, z: 0 } }, // يمين الماركر
        'scale-multiplier': { type: 'number', default: 1.35 }       // أكبر من الماركر
      },
      tick: function () {
        const m = this.data.marker && this.data.marker.object3D;
        if (!m) return;
        const s = m.scale, o = this.data.offset, k = this.data['scale-multiplier'];
        // الحجم يتبع حجم الماركر (علاقة طردية)
        this.el.object3D.scale.set(s.x * k, s.y * k, s.z * k);
        // الموضع يمين الماركر (بعد التحجيم)
        this.el.object3D.position.set(o.x * s.x, o.y * s.y, o.z * s.z);
      }
    });

    window.addEventListener('camera-init', ()=>console.log('✅ camera-init'));
    window.addEventListener('camera-error', e=>{
      alert('⚠️ تعذّر تشغيل الكاميرا.\nافتح الرابط على Safari/Chrome مباشرة وبصلاحية الكاميرا وHTTPS.');
      console.error(e);
    });
  </script>
</body>
</html>
